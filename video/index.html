<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频转换 - 小何转换</title>
    <link rel="icon" href="https://www.cmh.he.cn/img/logo.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #ffffff;
            min-height: 100vh;
            color: #000000;
            padding: 40px 20px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 40px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #000000;
            color: #ffffff;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .back-btn:hover {
            background-color: #333333;
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 600;
            color: #000000;
            letter-spacing: -0.02em;
        }

        .converter-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #f9f9f9;
            border: 1px solid #e6e6e6;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .upload-area {
            border: 2px dashed #e6e6e6;
            border-radius: 16px;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 32px;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .upload-area:hover {
            border-color: #000000;
        }

        .upload-icon {
            font-size: 3rem;
            color: #000000;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 1.1rem;
            color: #000000;
            margin-bottom: 8px;
        }

        .upload-subtext {
            font-size: 0.85rem;
            color: #6e6e73;
        }

        #file-input {
            display: none;
        }

        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-label {
            font-size: 0.95rem;
            font-weight: 500;
            color: #000000;
        }

        .setting-select {
            padding: 12px 16px;
            border: 1px solid #e6e6e6;
            border-radius: 12px;
            background-color: #ffffff;
            font-size: 0.95rem;
            color: #000000;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .setting-select:focus {
            outline: none;
            border-color: #000000;
        }

        .convert-btn {
            width: 100%;
            background-color: #000000;
            color: #ffffff;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .convert-btn:hover {
            background-color: #333333;
        }

        .convert-btn:disabled {
            background-color: #e6e6e6;
            color: #6e6e73;
            cursor: not-allowed;
        }

        .progress-container {
            height: 8px;
            background-color: #e6e6e6;
            border-radius: 4px;
            margin-bottom: 16px;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background-color: #000000;
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 1.8rem;
            }
            .converter-container {
                padding: 24px;
            }
            .upload-area {
                padding: 40px 20px;
            }
        }

        @media (max-width: 480px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            .page-title {
                font-size: 1.5rem;
            }
            .upload-icon {
                font-size: 2.2rem;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="header">
        <button class="back-btn" onclick="window.location.href='/'">
            <i class="fa fa-arrow-left"></i>
            <span>返回主页</span>
        </button>
        <h1 class="page-title">视频转换</h1>
    </div>

    <div class="converter-container">
        <div class="upload-area" onclick="document.getElementById('file-input').click()">
            <div class="upload-icon">
                <i class="fa fa-cloud-upload"></i>
            </div>
            <p class="upload-text">点击上传视频文件</p>
            <p class="upload-subtext">支持 MP4、AVI、MKV、MOV 等格式</p>
            <input type="file" id="file-input" accept="video/*" onchange="handleFileUpload(this)">
        </div>

        <div class="settings-container">
            <div class="setting-group">
                <label class="setting-label">输出格式</label>
                <select class="setting-select" id="format-select">
                    <option value="mp4">MP4 (推荐)</option>
                    <option value="avi">AVI</option>
                    <option value="mkv">MKV</option>
                    <option value="mov">MOV</option>
                    <option value="flv">FLV</option>
                    <option value="webm">WEBM</option>
                </select>
            </div>
            <div class="setting-group">
                <label class="setting-label">分辨率</label>
                <select class="setting-select" id="resolution-select">
                    <option value="original">保持原分辨率</option>
                    <option value="3840x2160">4K (3840x2160)</option>
                    <option value="2560x1440">2K (2560x1440)</option>
                    <option value="1920x1080">1080P (1920x1080)</option>
                    <option value="1280x720">720P (1280x720)</option>
                    <option value="854x480">480P (854x480)</option>
                    <option value="640x360">360P (640x360)</option>
                </select>
            </div>
            <div class="setting-group">
                <label class="setting-label">帧率</label>
                <select class="setting-select" id="fps-select">
                    <option value="original">保持原帧率</option>
                    <option value="60">60 FPS</option>
                    <option value="30">30 FPS</option>
                    <option value="24">24 FPS</option>
                    <option value="25">25 FPS</option>
                    <option value="15">15 FPS</option>
                </select>
            </div>
        </div>

        <div class="progress-container" id="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <button class="convert-btn" id="convert-btn" disabled onclick="handleConvert()">开始转换</button>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ 
            log: true,
            corePath: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js'
        });
        
        let selectedFile = null;

        function handleFileUpload(input) {
            if (input.files.length > 0) {
                selectedFile = input.files[0];
                document.getElementById('convert-btn').disabled = false;
                const fileName = selectedFile.name;
                document.querySelector('.upload-text').textContent = `已选择: ${fileName}`;
                document.querySelector('.upload-subtext').textContent = "点击可更换文件";
            }
        }

        async function handleConvert() {
            if (!selectedFile) return;

            const convertBtn = document.getElementById('convert-btn');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const format = document.getElementById('format-select').value;
            const resolution = document.getElementById('resolution-select').value;
            const fps = document.getElementById('fps-select').value;

            convertBtn.disabled = true;
            convertBtn.textContent = "转换中...";
            progressContainer.style.display = "block";
            progressBar.style.width = "0%";

            try {
                if (!ffmpeg.isLoaded()) {
                    await ffmpeg.load();
                    progressBar.style.width = "20%";
                }

                const inputFileName = `input.${selectedFile.name.split('.').pop()}`;
                const outputFileName = `output.${format}`;

                ffmpeg.FS('writeFile', inputFileName, await fetchFile(selectedFile));
                progressBar.style.width = "40%";

                let ffmpegArgs = ['-i', inputFile
